# LOG DI SVILUPPO - FAVELLA 1 (Sessione 0.0.5)

## OBIETTIVO: Implementazione Grammatica v0.4 - Interattività e Regole

La missione di questa sessione era trasformare FAVELLA da un descrittore di mondi statici a un motore di gioco interattivo. L'obiettivo principale era implementare le regole "Invece di", che permettono di sovrascrivere le azioni del giocatore per creare puzzle e interazioni personalizzate.

**Sintassi target:** `Invece di [VERBO] [NOME OGGETTO]: dire "[MESSAGGIO DI TESTO]".`

---

## FASE 1: Evoluzione dell'Architettura

Per supportare l'interattività, sono stati necessari tre interventi strutturali:

1.  **`strutture.py`:** È stata introdotta una nuova classe `Regola` per rappresentare la nuova sintassi. La classe `Mondo` è stata estesa con una lista `regole` per contenere le istanze di queste regole.
2.  **`compilatore.py`:** Il compilatore è stato potenziato per riconoscere la sintassi "Invece di".
3.  **Creazione di `gioco.py`:** È stato creato un nuovo file, `gioco.py`, che funge da punto di ingresso principale per la compilazione e l'esecuzione del ciclo di gioco interattivo (game loop).

---

## FASE 2: Debug Iniziale

Il primo test di esecuzione ha rivelato due bug critici:

1.  **Regex "Greedy" (AVIDA):** L'espressione regolare per le regole era troppo "avida" e catturava parti sbagliate della frase.
    *   **Soluzione:** La regex è stata corretta rendendo il gruppo del verbo "non-avido" (`.*?`).

2.  **Incoerenza nel File di Test:** Il file `storia.fav` usava nomi non coerenti per riferirsi allo stesso oggetto.
    *   **Soluzione:** Il file `storia.fav` è stato corretto per usare sempre nomi normalizzati.

---

## FASE 3: Debug Critico Post-Rilascio

Un test manuale approfondito ha rivelato due bug fondamentali che impedivano al gioco di funzionare come previsto.

1.  **Errore di Compilazione non Fatale:** Il compilatore segnalava correttamente gli errori di sintassi nel file `.fav`, ma non interrompeva l'esecuzione. Questo permetteva al gioco di avviarsi con un mondo "corrotto" e non funzionante.
    *   **Soluzione:** È stata modificata la comunicazione tra `compilatore.py` e `gioco.py`. Ora, `analizza_file` restituisce `None` se rileva errori. Il `main` di `gioco.py` controlla questo valore e arresta l'esecuzione se la compilazione è fallita, garantendo che si giochi solo su un mondo valido.

2.  **Mancata Corrispondenza dei Verbi:** Le regole venivano definite con verbi all'infinito (es. "prendere"), ma l'input del giocatore è naturalmente all'imperativo (es. "prendi"). Il motore di gioco non riconosceva questa differenza, causando il fallimento di tutte le regole.
    *   **Soluzione:** È stata implementata una `mappa_verbi` in `gioco.py`. Questa mappa normalizza i verbi comuni dall'imperativo all'infinito prima di confrontarli con le regole definite, rendendo il sistema di interazione flessibile e funzionante.

---

## RISULTATO FINALE

Questa sessione, incluse le fasi di debug critico, ha rappresentato un salto qualitativo per FAVELLA 1. Il progetto ora non solo descrive un mondo, ma permette al giocatore di interagirvi in modo robusto e intuitivo. Sono state gettate le fondamenta per tutte le future meccaniche di gioco complesse, con un sistema che gestisce gli errori e fornisce un feedback chiaro sia in fase di compilazione sia durante il gioco.