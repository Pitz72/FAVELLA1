# LOG DI SVILUPPO - FAVELLA 1 (Sessione 0.0.5)

## OBIETTIVO: Implementazione Grammatica v0.4 - Interattività e Regole

La missione di questa sessione era trasformare FAVELLA da un descrittore di mondi statici a un motore di gioco interattivo. L'obiettivo principale era implementare le regole "Invece di", che permettono di sovrascrivere le azioni del giocatore per creare puzzle e interazioni personalizzate.

**Sintassi target:** `Invece di [VERBO] [NOME OGGETTO]: dire "[MESSAGGIO DI TESTO]".`

---

## FASE 1: Evoluzione dell'Architettura

Per supportare l'interattività, sono stati necessari tre interventi strutturali:

1.  **`strutture.py`:** È stata introdotta una nuova classe `Regola` per rappresentare la nuova sintassi. La classe `Mondo` è stata estesa con una lista `regole` per contenere le istanze di queste regole. Il report di compilazione è stato aggiornato per mostrare il numero di regole definite.
2.  **`compilatore.py`:** Il compilatore è stato potenziato per riconoscere la sintassi "Invece di". È stata aggiunta una nuova espressione regolare, posizionata all'inizio della logica di parsing per darle priorità, dato che è la più specifica.
3.  **Creazione di `gioco.py`:** È stato creato un nuovo file, `gioco.py`, che funge da punto di ingresso principale. Questo file gestisce sia la fase di compilazione (chiamando `analizza_file` dal compilatore) sia l'esecuzione del ciclo di gioco interattivo (game loop), che legge e interpreta i comandi del giocatore.

---

## FASE 2: Debug e Correzioni

Il primo test di esecuzione ha rivelato due bug critici:

1.  **Regex "Greedy" (AVIDA):** L'espressione regolare per le regole, `(.*) (.*):`, era troppo "avida". Il primo gruppo (`.*`) catturava sia il verbo sia parte del nome dell'oggetto, causando errori di parsing.
    *   **Soluzione:** La regex è stata corretta rendendo il primo gruppo "non-avido": `(.*?) (.*):`. Questo assicura che il verbo e l'oggetto vengano separati correttamente.

2.  **Incoerenza nel File di Test:** Il file `storia.fav` definiva un oggetto con un nome completo (`Un piedistallo di pietra`) ma poi vi si riferiva con un nome breve (`Il piedistallo`) nelle regole, causando errori di "oggetto non trovato".
    *   **Soluzione:** Il file `storia.fav` è stato corretto per usare sempre il nome completo e normalizzato dell'oggetto, garantendo coerenza.

Dopo queste due correzioni, il test è stato superato con successo. Il compilatore ha prodotto l'output atteso e il motore di gioco si è avviato correttamente.

---

## RISULTATO FINALE

Questa sessione ha rappresentato un salto qualitativo per FAVELLA 1. Il progetto ora non solo descrive un mondo, ma permette al giocatore di interagirvi. Sono state gettate le fondamenta per tutte le future meccaniche di gioco complesse. Il sistema è robusto, gestisce gli errori e fornisce un feedback chiaro sia in fase di compilazione sia durante il gioco.
